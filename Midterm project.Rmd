---
title: "Midterm project"
output:
  word_document: default
  pdf_document: default
date: "2022-11-06"
author: "Yaquan Yang"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(magrittr)
library(readxl)
library(dplyr)
library(gmodels)
library(Rmisc)
```

```{r}
strawb <- read_xlsx("C:/Users/86150/Desktop/615/midterm project/strawberries-2022oct30-a.xlsx",col_names = TRUE)
head(strawb)
```
### Get the column names and index them
```{r}
cnames <- colnames(strawb)
x <- 1:dim(strawb)[2]
```

## Drop null columns
```{r}
unique(strawb[1])
unique(strawb[2])
unique(strawb[3])

T <- NULL
for(i in x){T <- c(T, dim(unique(strawb[i]))[1])}
drop_cols <- cnames[which(T == 1)]
strawb %<>% dplyr::select(!all_of(drop_cols)) # use dplyr::select instead of build-in select!!!
strawb %<>% arrange(Year, State)
```


## Separate "Data Item" column
```{r}
strawb %<>% separate(col=`Data Item`,
                    into = c("Strawberries", "type", "items", "units"),
                    sep = ",",
                    fill = "right")

```

```{r}
org_rows <- filter(strawb,str_detect(`Domain Category`,"ORGANIC"))
chem_rows <- filter(strawb,str_detect(`Domain Category`,"CHEMICAL"))
```


## Q2 
```{r}
Cal_organic_2016 <- strawb %>% filter(State=="CALIFORNIA",Year==2016,str_detect(`type`,"(ORGANIC - SALES)"))
# Cal_organic_2016 <- strawb %>% filter(State=="CALIFORNIA",Year==2016,Domain=="ORGANIC STATUS")

# We choose "ORGANIC - SALES, MEASURED IN $" for computing
Sales_value <-231304956
cv <- 0.137
mean <- Sales_value
sd <- cv*mean
upper <- mean+1.96*sd
lower <- mean-1.96*sd
upper
lower
```
## Q3 
```{r}
filter <- filter(strawb, State == 'CALIFORNIA' & Year == 2016 & Domain != 'ORGANIC STATUS')
Cal_non_organic_2016 <- filter(filter, Value != "(NA)" & Value != "(D)" & Domain != "TOTAL")

Value <- as.numeric(Cal_non_organic_2016$Value)

# Since we don't have the value of CV(%) for the "Cal_non_organic_2016" data, we can not compute the 95% CI of non-organic strawberry sales
```
## Q4
```{r}
chemical <- filter(strawb,str_detect(`Domain Category`,"(CHEMICAL|FERTILIZER)"))

n_distinct(chemical$`Domain Category`)
# Chemicals=175
```


## Q5
```{r}
chemical_florida <- filter(strawb,str_detect(`Domain Category`,"(CHEMICAL|FERTILIZER)"), State=="FLORIDA")
chemical_california <- filter(strawb,str_detect(`Domain Category`,"(CHEMICAL|FERTILIZER)"), State=="CALIFORNIA")
n_distinct(chemical_california$`Domain Category`)-n_distinct(chemical_florida$`Domain Category`)
#so the difference is 138 - 115=23
```

